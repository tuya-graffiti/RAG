# 项目架构

此处介绍项目三层架构,并扩展MVC架构和DDD架构

# 三层架构

**严格的单向依赖**

```
表现层 → 业务逻辑层 → 数据访问层
```

- 表现层不知道数据访问层的存在
- 业务逻辑层不关心数据如何存储
- 数据访问层不包含业务规则

```
rag_project/
├── base/                           # 【基础设施层】基础配置管理
│   ├── _gen_config.py             # 配置生成脚本
│   ├── config.ini                 # 配置文件
│   ├── config_gen.py              # 配置生成器
│   ├── config_parser.py           # 配置解析器
│   └── configs.py                 # 配置管理类
├── conn/                          # 【基础设施层】外部服务连接管理
│   ├── llms.py                    # 大语言模型连接
│   ├── milvus_conn.py             # Milvus向量数据库连接
│   ├── mysql_conn.py              # MySQL数据库连接
│   ├── redis_conn.py              # Redis缓存连接
│   └── rerank_conn.py             # 重排序模型连接
├── datas/                         # 【基础设施层】数据和模型存储
│   ├── models/                    # 模型文件（各种预训练模型）
│   ├── rerords/                   # 记录文件
│   ├── download_model.py          # 模型下载脚本
│   └── filepaths.py               # 文件路径管理
├── env/                           # 【基础设施层】环境配置
│   ├── deepseek_envs.py           # DeepSeek API环境配置
│   ├── langsmith_env.py           # LangSmith环境配置
│   ├── serect.py                  # 密钥配置
│   └── silicon_envs.py            # Silicon API环境配置
├── frontend/                      # 【表现层】前端界面
│   └── chat.html                  # 聊天界面
├── managers/                      # 【基础设施层】数据访问层
│   ├── mysql_manager.py           # MySQL数据访问
│   ├── redis_manager.py           # Redis数据访问
│   └── vector_store.py            # 向量存储数据访问
├── offline/                       # 【业务逻辑层】离线数据处理
│   ├── fine_tune_query_clissifier/gen_datas/  # 查询分类器微调数据生成
│   │   ├── agents/                # 智能体模块
│   │   │   ├── chat_message_agent.py         # 聊天消息代理
│   │   │   ├── check_general_knowledge_agent.py  # 通用知识检查代理
│   │   │   ├── general_knowledge_agent.py    # 通用知识代理
│   │   │   └── specific_knowledge_agent.py   # 专业知识代理
│   │   ├── my_tools/              # 自定义工具
│   │   │   ├── draw_graph.py      # 图形绘制工具
│   │   │   └── read_chunks.py     # 文档片段读取工具
│   │   ├── config.py              # 配置文件
│   │   ├── gen_data_workflow.py   # 数据生成工作流
│   │   ├── graph.html             # 图形展示页面
│   │   ├── total_datas.json       # 总数据文件
│   │   └── 统计一下.py             # 数据统计脚本
│   ├── insert2milvus/             # 数据插入Milvus
│   │   ├── doc_process.py         # 文档处理
│   │   └── insert2milvus.py       # 数据插入Milvus
│   ├── insert2mysql/              # 数据插入MySQL
│   │   └── insert2mysql.py        # 数据插入MySQL
│   └── rages_evaluation/          # RAG系统评估
│       ├── datas/                 # 评估数据
│       ├── reports/               # 评估报告
│       ├── evaluate.py            # 评估脚本
│       └── gen_data.py            # 数据生成脚本
├── online/                        # 【业务逻辑层】在线服务模块
│   ├── mysql_search/              # MySQL搜索业务逻辑
│   │   └── bm25_search.py         # BM25搜索算法
│   ├── rag_system/                # RAG系统核心业务逻辑
│   │   ├── prompts.py             # 提示词模板
│   │   ├── query_classifier.py    # 查询分类器
│   │   ├── rag_system_final.py    # RAG系统最终版本
│   │   ├── rag_system_simple.py   # RAG系统简化版本
│   │   ├── rag_system_with_strategy_selector.py  # 带策略选择器的RAG系统
│   │   └── strategy_selector.py   # 策略选择器
│   └── major.py                   # 【业务逻辑层】主要业务流程协调
├── study/                         # 【其他】学习示例模块
├── utils/                         # 【基础设施层】通用工具
│   ├── agent_util/                # 智能体工具
│   │   └── gen_frontend_from_fastapi.py  # 从FastAPI生成前端
│   ├── doc_utils/                 # 文档工具
│   │   ├── extra/doc_process/     # 额外文档处理
│   │   │   ├── doc_loaders/       # 文档加载器
│   │   │   │   ├── edu_docloader.py      # 文档加载器
│   │   │   │   ├── edu_imgloader.py      # 图片加载器
│   │   │   │   ├── edu_ocr.py            # OCR工具
│   │   │   │   ├── edu_pdfloader.py      # PDF加载器
│   │   │   │   └── edu_pptloader.py      # PPT加载器
│   │   │   ├── text_splitters/    # 文本分割器
│   │   │   │   ├── edu_chinese_recursive_text_splitter.py  # 中文递归分割器
│   │   │   │   └── edu_model_text_spliter.py               # 模型文本分割器
│   │   │   └── document_loader.py # 文档加载器
│   │   ├── doc_reader_utils.py    # 文档读取工具
│   │   └── text_splitters_utils.py # 文本分割工具
│   └── general_utils/             # 通用工具
│       ├── globle_util.py         # 全局工具
│       ├── loggers.py             # 日志工具
│       ├── prase_json.py          # JSON解析工具
│       └── time_util.py           # 时间工具
├── app.py                         # 【表现层】主应用入口（API接口）
└── requirement.txt                # 项目依赖
```

## 总结

### 表现层 (Presentation Layer)

- `frontend/` - 用户界面
- `app.py` - API接口入口

### 业务逻辑层 (Business Logic Layer)

- `online/` - 在线业务逻辑（查询路由、RAG生成、FAQ检索）
- `offline/` - 离线业务逻辑（数据处理、模型训练、系统评估）

### 基础设施层 (Infrastructure Layer)

- `conn/` - 外部服务连接
- `managers/` - 数据访问封装
- `base/` - 配置管理
- `env/` - 环境配置
- `utils/` - 通用工具
- `datas/` - 数据存储

### 其他

- `study/` - 学习示例代码

# DDD领域驱动设计

core:通过领域驱动设计方法定义领域模型，从而确定业务和应用边界，保证业务模型和代码模型的一致性。

intro:DDD是一种设计思想，通过`事件风暴`使用`通用语言`对业务进行`领域建模`，通过`限界上下文`进行合理的`领域拆分`，可以使得`领域模型转向微服务的设计和落地`，从而解决复杂软件难以理解，难以演进，也可以解决微服务业务界限难以界定的问题。

DDD一般用于大型项目，由于本项目过小没有采用 但是又由于朱波可能是ADHD所以含了点

```
表现层 (Presentation Layer)
   ↓
应用层 (Application Layer)  
   ↓
领域层 (Domain Layer)
   ↓
基础设施层 (Infrastructure Layer)
```

大致的目录与DDD架构的对应关系为

~~~
[基础配置层]:
	base utils conn env datas
[领域层+应用层]:
	offline online
[表现层]:
	fontend study 
~~~

# MVC项目架构

## MVC核心组件及职责

(1) Model（模型层）
角色：处理数据和业务逻辑的“秘书”。

包含内容：

POJO/Bean/Domain：数据实体类，描述业务对象。

Service：实现核心业务逻辑（如用户注册、订单处理）。

Dao（Data Access Object数据库访问对象）：负责数据持久化操作（如数据库增删改查）。

职责：

封装业务逻辑和数据操作。

独立于视图和控制器，确保数据一致性。

(2) View（视图层）
角色：负责展示数据的“秘书”。

常见技术：JSP、Thymeleaf、HTML、Freemarker 等。

职责：

接收来自控制器的数据，渲染用户界面。

被动展示：避免包含业务逻辑，仅处理显示逻辑（如数据格式化）。

(3) Controller（控制器层）
角色：协调调度的“司令官”。

职责：

接收用户请求（如HTTP请求）。

调用Model处理业务逻辑（如调用Service层）。

根据处理结果选择合适的视图进行渲染。

控制流程，但不直接处理数据或展示逻辑。

## 示例

**用户请求**：通过View（如HTML表单）提交注册信息。

**Controller接收**：解析请求参数，调用Model层的UserService处理注册逻辑。

**Model处理**：

- UserService校验数据，调用UserDao将数据存入数据库。

- 返回处理结果（成功/失败）给Controller。

**Controller响应**：根据结果选择View（如跳转到成功页或错误页）。

**View渲染**：展示最终页面给用户。

